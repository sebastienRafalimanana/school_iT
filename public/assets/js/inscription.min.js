// script pour le barre de prgressoin //
const progress = document.getElementById("progress");
const prev = document.getElementById("prev");
const next = document.getElementById("next");
const circles = document.querySelectorAll(".circle");
const taskname = document.getElementById("taskName");
const infoSco = document.getElementById("info-sco");
const infoEtu = document.getElementById("info-etu");
const conclu = document.getElementById("conclusion");
progress.style.width = 0 + "%";
var currentActive = 1;
var information = null;

next.addEventListener("click", () => {
    currentActive++;
    if (currentActive > circles.length) {
        url = "http://localhost/G-School/api/service/inscription.php";
        $.post(url, JSON.stringify(information), function(res,){
            console.log(res);
           if (res == "err") {
            swal({
                icon: 'warning',
                title: 'Duplication ...',
                text: 'Cette Etudiant est déjà inscrit',
                footer: '<a href="">Why do I have this issue?</a>',
                showCloseButton: true,
              })
              information = null;
           }
           else{
            currentActive = circles.length;
            swal("", "Etudiant inscrit avec success...", "success");
           }
            
          
        });
    
    }
    update();
    change();
});
prev.addEventListener("click", () => {
    currentActive--;
    if (currentActive < 1) {
        currentActive = 1;
    }
    update();
    change();
});

function update() {
    circles.forEach((circle, idx) => {
        if (idx < currentActive) {
            circle.classList.add("active");
        } else {
            circle.classList.remove("active");
        }
    });
    const actives = document.querySelectorAll(".active");
    progress.style.width =
        ((actives.length - 2) / (circles.length - 1)) * 100 + "%";

    if (progress.style.width == "100%") {
        next.innerText = "Terminer";
    } else {
        next.innerText = "suivant";
    }
}
// cette liste va contenir les donnés de l'inscription


function change() {
    if (currentActive == "1") {
        taskname.innerText = "Information sur l'inscription";
        infoSco.style.zIndex = "1";
        infoEtu.style.zIndex = "0";
        conclu.style.zIndex = "0";
    }
    if (currentActive == "2") {
        taskname.innerText = "Information sur l'etudiant";
        infoEtu.style.zIndex = "1";
        infoSco.style.zIndex = "0";
        conclu.style.zIndex = "0";
    }
    if (currentActive == "3") {
        taskname.innerText = "Resumé de l'inscription";
        infoEtu.style.zIndex = "0";
        infoSco.style.zIndex = "0";
        conclu.style.zIndex = "1";
        // cette liste va contenir les donnés de l'inscription
        information ={
            annee : $("#anne_unniv").val(),
            mention : $("#mention").val(),
            niveau : $("#niveau").val(),
            matricule : $("#matricule").val(),
            nom : $("#nom").val(),
            prenom : $("#prenom").val(),
            date_naissance : $("#date_naissance").val(),
        };

        // affichage de donnés de l'inscritpion
        $("#num_matri").text(information.matricule);
        $("#fname_etu").text(information.nom);
        $("#lname_etu").text(information.prenom);
        $("#dnaiss_etu").text(information.date_naissance);
        $("#a_univ").text(information.annee);
        $("#mention_etu").text(information.mention);
        if (information.niveau <=3) {
            $("#niveau_etu").text("L"+information.niveau);
        }
        else{
            information.niveau ==4 ?   $("#niveau_etu").text("M1") :   $("#niveau_etu").text("M2")
        }
    }
}